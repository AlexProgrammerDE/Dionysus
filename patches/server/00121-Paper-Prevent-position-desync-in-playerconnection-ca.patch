From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Softik Lord <dimap9986@gmail.com>
Date: Mon, 18 Jul 2022 12:40:41 +0500
Subject: [PATCH] Paper-Prevent-position-desync-in-playerconnection-causing


diff --git a/src/main/java/net/minecraft/server/PlayerConnection.java b/src/main/java/net/minecraft/server/PlayerConnection.java
index 7561307aef37a0eee09f6460c938439a09545fc0..65e90e2e291633646b2f4be5a35f8a271121cf5b 100644
--- a/src/main/java/net/minecraft/server/PlayerConnection.java
+++ b/src/main/java/net/minecraft/server/PlayerConnection.java
@@ -657,6 +657,11 @@ public class PlayerConnection implements PacketListenerPlayIn, ITickable {
                             }
 
                             this.player.move(EnumMoveType.PLAYER, d7, d8, d9);
+                            // Paper start - prevent position desync
+                            if (this.teleportPos != null) {
+                                return; // ... thanks Mojang for letting move calls teleport across dimensions.
+                            }
+                            // Paper end - prevent position desync
                             this.player.onGround = packetplayinflying.a();
                             double d12 = d8;
 
